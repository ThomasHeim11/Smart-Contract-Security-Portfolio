# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [Medium Issues](#medium-issues)
  - [M-1: Centralization Risk for trusted owners](#m-1-centralization-risk-for-trusted-owners)
- [Low Issues](#low-issues)
  - [L-1: Solidity pragma should be specific, not wide](#l-1-solidity-pragma-should-be-specific-not-wide)
  - [L-2: Conditional storage checks are not consistent](#l-2-conditional-storage-checks-are-not-consistent)
  - [L-3: PUSH0 is not supported by all chains](#l-3-push0-is-not-supported-by-all-chains)
- [NC Issues](#nc-issues)
  - [NC-1: Missing checks for `address(0)` when assigning values to address state variables](#nc-1-missing-checks-for-address0-when-assigning-values-to-address-state-variables)
  - [NC-2: Functions not used internally could be marked external](#nc-2-functions-not-used-internally-could-be-marked-external)
  - [NC-3: Constants should be defined and used instead of literals](#nc-3-constants-should-be-defined-and-used-instead-of-literals)
  - [NC-4: Event is missing `indexed` fields](#nc-4-event-is-missing-indexed-fields)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 33 |
| Total nSLOC | 4043 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| contracts/ChainlinkOracle.sol | 19 |
| contracts/MultiHopOracle.sol | 37 |
| contracts/QuantAMMStorage.sol | 385 |
| contracts/QuantAMMWeightedPool.sol | 570 |
| contracts/QuantAMMWeightedPoolFactory.sol | 122 |
| contracts/UpdateWeightRunner.sol | 390 |
| contracts/mock/MockCalculationRule.sol | 104 |
| contracts/mock/MockPool.sol | 107 |
| contracts/mock/MockQuantAMMBasePool.sol | 111 |
| contracts/mock/MockQuantAMMMathGuard.sol | 12 |
| contracts/mock/MockQuantAMMStorage.sol | 61 |
| contracts/mock/MockRuleInvoker.sol | 30 |
| contracts/mock/MockUpdateWeightRunner.sol | 37 |
| contracts/mock/QuantAMMWeightedMathMock.sol | 34 |
| contracts/mock/mockRules/MockAntiMomentumRule.sol | 32 |
| contracts/mock/mockRules/MockDifferenceMomentumRule.sol | 32 |
| contracts/mock/mockRules/MockMinimumVarianceRule.sol | 32 |
| contracts/mock/mockRules/MockMomentumRule.sol | 32 |
| contracts/mock/mockRules/MockPowerChannelRule.sol | 32 |
| contracts/mock/mockRules/MockUpdateRule.sol | 38 |
| contracts/rules/AntimomentumUpdateRule.sol | 115 |
| contracts/rules/ChannelFollowingUpdateRule.sol | 184 |
| contracts/rules/DifferenceMomentumUpdateRule.sol | 163 |
| contracts/rules/MinimumVarianceUpdateRule.sol | 88 |
| contracts/rules/MomentumUpdateRule.sol | 119 |
| contracts/rules/PowerChannelUpdateRule.sol | 145 |
| contracts/rules/UpdateRule.sol | 154 |
| contracts/rules/base/QuantammBasedRuleHelpers.sol | 7 |
| contracts/rules/base/QuantammCovarianceBasedRule.sol | 116 |
| contracts/rules/base/QuantammGradientBasedRule.sol | 139 |
| contracts/rules/base/QuantammMathGuard.sol | 94 |
| contracts/rules/base/QuantammMathMovingAverage.sol | 52 |
| contracts/rules/base/QuantammVarianceBasedRule.sol | 151 |
| **Total** | **4043** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| Critical | 0 |
| High | 0 |
| Medium | 1 |
| Low | 3 |
| NC | 4 |


# Medium Issues

## M-1: Centralization Risk for trusted owners

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

- Found in contracts/UpdateWeightRunner.sol [Line: 51](contracts/UpdateWeightRunner.sol#L51)

	```solidity
	contract UpdateWeightRunner is Ownable2Step, IUpdateWeightRunner {
	```



# Low Issues

## L-1: Solidity pragma should be specific, not wide

Consider using a specific version of Solidity in your contracts instead of a wide version. For example, instead of `pragma solidity ^0.8.0;`, use `pragma solidity 0.8.0;`

- Found in contracts/ChainlinkOracle.sol [Line: 2](contracts/ChainlinkOracle.sol#L2)

	```solidity
	pragma solidity >=0.8.20;
	```

- Found in contracts/MultiHopOracle.sol [Line: 2](contracts/MultiHopOracle.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 2](contracts/QuantAMMStorage.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 3](contracts/QuantAMMWeightedPool.sol#L3)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/QuantAMMWeightedPoolFactory.sol [Line: 3](contracts/QuantAMMWeightedPoolFactory.sol#L3)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 2](contracts/UpdateWeightRunner.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockCalculationRule.sol [Line: 2](contracts/mock/MockCalculationRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockPool.sol [Line: 2](contracts/mock/MockPool.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockQuantAMMBasePool.sol [Line: 2](contracts/mock/MockQuantAMMBasePool.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockQuantAMMMathGuard.sol [Line: 2](contracts/mock/MockQuantAMMMathGuard.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockQuantAMMStorage.sol [Line: 2](contracts/mock/MockQuantAMMStorage.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockRuleInvoker.sol [Line: 2](contracts/mock/MockRuleInvoker.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockUpdateWeightRunner.sol [Line: 2](contracts/mock/MockUpdateWeightRunner.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/QuantAMMWeightedMathMock.sol [Line: 3](contracts/mock/QuantAMMWeightedMathMock.sol#L3)

	```solidity
	pragma solidity ^0.8.24;
	```

- Found in contracts/mock/mockRules/MockAntiMomentumRule.sol [Line: 2](contracts/mock/mockRules/MockAntiMomentumRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockDifferenceMomentumRule.sol [Line: 2](contracts/mock/mockRules/MockDifferenceMomentumRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockMinimumVarianceRule.sol [Line: 2](contracts/mock/mockRules/MockMinimumVarianceRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockMomentumRule.sol [Line: 2](contracts/mock/mockRules/MockMomentumRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockPowerChannelRule.sol [Line: 2](contracts/mock/mockRules/MockPowerChannelRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockUpdateRule.sol [Line: 3](contracts/mock/mockRules/MockUpdateRule.sol#L3)

	```solidity
	pragma solidity ^0.8.24;
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 2](contracts/rules/AntimomentumUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 2](contracts/rules/ChannelFollowingUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 2](contracts/rules/DifferenceMomentumUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/MinimumVarianceUpdateRule.sol [Line: 2](contracts/rules/MinimumVarianceUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 2](contracts/rules/MomentumUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 2](contracts/rules/PowerChannelUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/UpdateRule.sol [Line: 2](contracts/rules/UpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammBasedRuleHelpers.sol [Line: 2](contracts/rules/base/QuantammBasedRuleHelpers.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammCovarianceBasedRule.sol [Line: 2](contracts/rules/base/QuantammCovarianceBasedRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammGradientBasedRule.sol [Line: 2](contracts/rules/base/QuantammGradientBasedRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammMathGuard.sol [Line: 2](contracts/rules/base/QuantammMathGuard.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammMathMovingAverage.sol [Line: 2](contracts/rules/base/QuantammMathMovingAverage.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 2](contracts/rules/base/QuantammVarianceBasedRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```



## L-2: Conditional storage checks are not consistent

When writing `require` or `if` conditionals that check storage values, it is important to be consistent to prevent off-by-one errors. There are instances found where the same storage variable is checked multiple times, but the conditionals are not consistent.

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 122](contracts/rules/ChannelFollowingUpdateRule.sol#L122)

	```solidity
	        locals.useRawPrice = _parameters[6][0] == ONE;
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 208](contracts/rules/ChannelFollowingUpdateRule.sol#L208)

	```solidity
	            trendPortion = trendPortion.mul(ONE - envelope);
	```

- Found in contracts/rules/MinimumVarianceUpdateRule.sol [Line: 46](contracts/rules/MinimumVarianceUpdateRule.sol#L46)

	```solidity
	            int256 oneMinusLambda = ONE - mixingVariance;
	```

- Found in contracts/rules/MinimumVarianceUpdateRule.sol [Line: 69](contracts/rules/MinimumVarianceUpdateRule.sol#L69)

	```solidity
	                int256 oneMinusLambda = ONE - mixingVariance;
	```

- Found in contracts/rules/MinimumVarianceUpdateRule.sol [Line: 117](contracts/rules/MinimumVarianceUpdateRule.sol#L117)

	```solidity
	                if (_parameters[0][i] < 0 || _parameters[0][i] > ONE) {
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 80](contracts/rules/PowerChannelUpdateRule.sol#L80)

	```solidity
	            locals.useRawPrice = _parameters[2][0] == ONE;
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 197](contracts/rules/PowerChannelUpdateRule.sol#L197)

	```solidity
	                if(parameters[1][i] <= ONE){
	```



## L-3: PUSH0 is not supported by all chains

Solc compiler version 0.8.20 switches the default target EVM version to Shanghai, which means that the generated bytecode will include PUSH0 opcodes. Be sure to select the appropriate EVM version in case you intend to deploy on a chain other than mainnet like L2 chains that may not support PUSH0, otherwise deployment of your contracts will fail.

- Found in contracts/ChainlinkOracle.sol [Line: 2](contracts/ChainlinkOracle.sol#L2)

	```solidity
	pragma solidity >=0.8.20;
	```

- Found in contracts/MultiHopOracle.sol [Line: 2](contracts/MultiHopOracle.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 2](contracts/QuantAMMStorage.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 3](contracts/QuantAMMWeightedPool.sol#L3)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/QuantAMMWeightedPoolFactory.sol [Line: 3](contracts/QuantAMMWeightedPoolFactory.sol#L3)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 2](contracts/UpdateWeightRunner.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockCalculationRule.sol [Line: 2](contracts/mock/MockCalculationRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockPool.sol [Line: 2](contracts/mock/MockPool.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockQuantAMMBasePool.sol [Line: 2](contracts/mock/MockQuantAMMBasePool.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockQuantAMMMathGuard.sol [Line: 2](contracts/mock/MockQuantAMMMathGuard.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockQuantAMMStorage.sol [Line: 2](contracts/mock/MockQuantAMMStorage.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockRuleInvoker.sol [Line: 2](contracts/mock/MockRuleInvoker.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/MockUpdateWeightRunner.sol [Line: 2](contracts/mock/MockUpdateWeightRunner.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/QuantAMMWeightedMathMock.sol [Line: 3](contracts/mock/QuantAMMWeightedMathMock.sol#L3)

	```solidity
	pragma solidity ^0.8.24;
	```

- Found in contracts/mock/mockRules/MockAntiMomentumRule.sol [Line: 2](contracts/mock/mockRules/MockAntiMomentumRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockDifferenceMomentumRule.sol [Line: 2](contracts/mock/mockRules/MockDifferenceMomentumRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockMinimumVarianceRule.sol [Line: 2](contracts/mock/mockRules/MockMinimumVarianceRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockMomentumRule.sol [Line: 2](contracts/mock/mockRules/MockMomentumRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockPowerChannelRule.sol [Line: 2](contracts/mock/mockRules/MockPowerChannelRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/mock/mockRules/MockUpdateRule.sol [Line: 3](contracts/mock/mockRules/MockUpdateRule.sol#L3)

	```solidity
	pragma solidity ^0.8.24;
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 2](contracts/rules/AntimomentumUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 2](contracts/rules/ChannelFollowingUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 2](contracts/rules/DifferenceMomentumUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/MinimumVarianceUpdateRule.sol [Line: 2](contracts/rules/MinimumVarianceUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 2](contracts/rules/MomentumUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 2](contracts/rules/PowerChannelUpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/UpdateRule.sol [Line: 2](contracts/rules/UpdateRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammBasedRuleHelpers.sol [Line: 2](contracts/rules/base/QuantammBasedRuleHelpers.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammCovarianceBasedRule.sol [Line: 2](contracts/rules/base/QuantammCovarianceBasedRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammGradientBasedRule.sol [Line: 2](contracts/rules/base/QuantammGradientBasedRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammMathGuard.sol [Line: 2](contracts/rules/base/QuantammMathGuard.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammMathMovingAverage.sol [Line: 2](contracts/rules/base/QuantammMathMovingAverage.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 2](contracts/rules/base/QuantammVarianceBasedRule.sol#L2)

	```solidity
	pragma solidity >=0.8.24;
	```



# NC Issues

## NC-1: Missing checks for `address(0)` when assigning values to address state variables

Assigning values to address state variables without checking for `address(0)`.

- Found in contracts/mock/MockQuantAMMBasePool.sol [Line: 81](contracts/mock/MockQuantAMMBasePool.sol#L81)

	```solidity
	        poolAddress = _poolAddress;
	```



## NC-2: Functions not used internally could be marked external



- Found in contracts/QuantAMMWeightedPool.sol [Line: 234](contracts/QuantAMMWeightedPool.sol#L234)

	```solidity
	    function computeInvariant(uint256[] memory balancesLiveScaled18, Rounding rounding) public view returns (uint256) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 249](contracts/QuantAMMWeightedPool.sol#L249)

	```solidity
	    function onSwap(PoolSwapParams memory request) public view onlyVault returns (uint256) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 694](contracts/QuantAMMWeightedPool.sol#L694)

	```solidity
	    function initialize(
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 823](contracts/QuantAMMWeightedPool.sol#L823)

	```solidity
	    function getRate() public pure override returns (uint256) {
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 162](contracts/UpdateWeightRunner.sol#L162)

	```solidity
	    function getOptimisedPoolOracle(address _poolAddress) public view returns (address[] memory oracles) {
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 168](contracts/UpdateWeightRunner.sol#L168)

	```solidity
	    function getPoolOracleAndBackups(address _poolAddress) public view returns (address[][] memory oracles) {
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 174](contracts/UpdateWeightRunner.sol#L174)

	```solidity
	    function getPoolRuleSettings(address _poolAddress) public view returns (PoolRuleSettings memory oracles) {
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 180](contracts/UpdateWeightRunner.sol#L180)

	```solidity
	    function getPoolApprovedActions(address _poolAddress) public view returns (uint256) {
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 198](contracts/UpdateWeightRunner.sol#L198)

	```solidity
	    function getPoolRule(address _poolAddress) public view returns (IUpdateRule rule) {
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 304](contracts/UpdateWeightRunner.sol#L304)

	```solidity
	    function setETHUSDOracle(address _ethUsdOracle) public {
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 340](contracts/UpdateWeightRunner.sol#L340)

	```solidity
	    function getData(address _pool) public view virtual returns (int256[] memory outputData) {
	```

- Found in contracts/mock/MockPool.sol [Line: 82](contracts/mock/MockPool.sol#L82)

	```solidity
	    function callSetRuleForPool(
	```

- Found in contracts/mock/MockPool.sol [Line: 105](contracts/mock/MockPool.sol#L105)

	```solidity
	    function setLambda(int256 _lambda) public {
	```

- Found in contracts/mock/MockPool.sol [Line: 109](contracts/mock/MockPool.sol#L109)

	```solidity
	    function setEpsilonMax(int256 _epsilonMax) public {
	```

- Found in contracts/mock/MockPool.sol [Line: 113](contracts/mock/MockPool.sol#L113)

	```solidity
	    function setAbsoluteWeightGuardRail(int256 _absoluteWeightGuardRail) public {
	```

- Found in contracts/mock/MockPool.sol [Line: 117](contracts/mock/MockPool.sol#L117)

	```solidity
	    function setInvariant(uint256 _invariant) public {
	```

- Found in contracts/mock/MockPool.sol [Line: 121](contracts/mock/MockPool.sol#L121)

	```solidity
	    function getTokenAddress() public pure returns (address tokenAddress) {
	```

- Found in contracts/mock/MockPool.sol [Line: 129](contracts/mock/MockPool.sol#L129)

	```solidity
	    function setPoolLPTokenValue(uint256 _poolLPTokenValue) public {
	```

- Found in contracts/mock/MockPool.sol [Line: 133](contracts/mock/MockPool.sol#L133)

	```solidity
	    function getPoolLPTokenValue(int256[] memory /*_prices*/) public view returns (uint256) {
	```

- Found in contracts/mock/MockPool.sol [Line: 137](contracts/mock/MockPool.sol#L137)

	```solidity
	    function afterTokenTransfer(address /*from*/, address /*to*/, uint256 firstTokenId) public {
	```

- Found in contracts/mock/MockRuleInvoker.sol [Line: 13](contracts/mock/MockRuleInvoker.sol#L13)

	```solidity
	    function getWeights() public view returns (int256[] memory) {
	```

- Found in contracts/mock/MockUpdateWeightRunner.sol [Line: 22](contracts/mock/MockUpdateWeightRunner.sol#L22)

	```solidity
	    function calculateMultiplierAndSetWeights(int256[] memory oldWeights,
	```

- Found in contracts/mock/MockUpdateWeightRunner.sol [Line: 40](contracts/mock/MockUpdateWeightRunner.sol#L40)

	```solidity
	    function getData(address _pool) public view override returns (int256[] memory outputData) {
	```



## NC-3: Constants should be defined and used instead of literals



- Found in contracts/ChainlinkOracle.sol [Line: 21](contracts/ChainlinkOracle.sol#L21)

	```solidity
	        normalizationFactor = 18 - priceFeed.decimals();
	```

- Found in contracts/ChainlinkOracle.sol [Line: 31](contracts/ChainlinkOracle.sol#L31)

	```solidity
	        data = data * int(10 ** normalizationFactor);
	```

- Found in contracts/MultiHopOracle.sol [Line: 32](contracts/MultiHopOracle.sol#L32)

	```solidity
	            data = 10 ** 36 / data; // 10^36 (i.e., 1 with 18 decimals * 10^18) to get the inverse with 18 decimals.
	```

- Found in contracts/MultiHopOracle.sol [Line: 37](contracts/MultiHopOracle.sol#L37)

	```solidity
	        for (uint i = 1; i < oracleLength; ) {
	```

- Found in contracts/MultiHopOracle.sol [Line: 46](contracts/MultiHopOracle.sol#L46)

	```solidity
	                data = (data * 10 ** 18) / oracleRes;
	```

- Found in contracts/MultiHopOracle.sol [Line: 48](contracts/MultiHopOracle.sol#L48)

	```solidity
	                data = (data * oracleRes) / 10 ** 18;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 37](contracts/QuantAMMStorage.sol#L37)

	```solidity
	        packed = (_leftInt << 128) | int256(uint256(_rightInt << 128) >> 128);
	```

- Found in contracts/QuantAMMStorage.sol [Line: 87](contracts/QuantAMMStorage.sol#L87)

	```solidity
	        int256 firstPacked = int256(uint256(_firstInt << 224) >> 224) << 224;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 88](contracts/QuantAMMStorage.sol#L88)

	```solidity
	        int256 secondPacked = int256(uint256(_secondInt << 224) >> 224) << 192;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 89](contracts/QuantAMMStorage.sol#L89)

	```solidity
	        int256 thirdPacked = int256(uint256(_thirdInt << 224) >> 224) << 160;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 90](contracts/QuantAMMStorage.sol#L90)

	```solidity
	        int256 fourthPacked = int256(uint256(_fourthInt << 224) >> 224) << 128;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 91](contracts/QuantAMMStorage.sol#L91)

	```solidity
	        int256 fifthPacked = int256(uint256(_fifthInt << 224) >> 224) << 96;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 92](contracts/QuantAMMStorage.sol#L92)

	```solidity
	        int256 sixthPacked = int256(uint256(_sixthInt << 224) >> 224) << 64;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 93](contracts/QuantAMMStorage.sol#L93)

	```solidity
	        int256 seventhPacked = int256(uint256(_seventhInt << 224) >> 224) << 32;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 94](contracts/QuantAMMStorage.sol#L94)

	```solidity
	        int256 eighthPacked = int256(uint256(_eighthInt << 224) >> 224);
	```

- Found in contracts/QuantAMMStorage.sol [Line: 110](contracts/QuantAMMStorage.sol#L110)

	```solidity
	        targetArray = new int256[](8);
	```

- Found in contracts/QuantAMMStorage.sol [Line: 111](contracts/QuantAMMStorage.sol#L111)

	```solidity
	        targetArray[0] = (sourceElem >> 224) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 112](contracts/QuantAMMStorage.sol#L112)

	```solidity
	        targetArray[1] = int256(int32(sourceElem >> 192)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 113](contracts/QuantAMMStorage.sol#L113)

	```solidity
	        targetArray[2] = int256(int32(sourceElem >> 160)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 114](contracts/QuantAMMStorage.sol#L114)

	```solidity
	        targetArray[3] = int256(int32(sourceElem >> 128)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 115](contracts/QuantAMMStorage.sol#L115)

	```solidity
	        targetArray[4] = int256(int32(sourceElem >> 96)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 116](contracts/QuantAMMStorage.sol#L116)

	```solidity
	        targetArray[5] = int256(int32(sourceElem >> 64)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 117](contracts/QuantAMMStorage.sol#L117)

	```solidity
	        targetArray[6] = int256(int32(sourceElem >> 32)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 118](contracts/QuantAMMStorage.sol#L118)

	```solidity
	        targetArray[7] = int256(int32(sourceElem)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 130](contracts/QuantAMMStorage.sol#L130)

	```solidity
	        require(_sourceArray.length * 8 >= _targetArrayLength, "SRC!=TGT");
	```

- Found in contracts/QuantAMMStorage.sol [Line: 133](contracts/QuantAMMStorage.sol#L133)

	```solidity
	        uint sourceArrayLengthMinusOne = _sourceArray.length - 1;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 134](contracts/QuantAMMStorage.sol#L134)

	```solidity
	        bool divisibleByEight = _targetArrayLength % 8 == 0;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 138](contracts/QuantAMMStorage.sol#L138)

	```solidity
	        if (_targetArrayLength > 8) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 143](contracts/QuantAMMStorage.sol#L143)

	```solidity
	                        targetArray[targetIndex] = (sourceElem >> 224) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 146](contracts/QuantAMMStorage.sol#L146)

	```solidity
	                        targetArray[targetIndex] = int256(int32(sourceElem >> 192)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 149](contracts/QuantAMMStorage.sol#L149)

	```solidity
	                        targetArray[targetIndex] = int256(int32(sourceElem >> 160)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 152](contracts/QuantAMMStorage.sol#L152)

	```solidity
	                        targetArray[targetIndex] = int256(int32(sourceElem >> 128)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 155](contracts/QuantAMMStorage.sol#L155)

	```solidity
	                        targetArray[targetIndex] = int256(int32(sourceElem >> 96)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 158](contracts/QuantAMMStorage.sol#L158)

	```solidity
	                        targetArray[targetIndex] = int256(int32(sourceElem >> 64)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 161](contracts/QuantAMMStorage.sol#L161)

	```solidity
	                        targetArray[targetIndex] = int256(int32(sourceElem >> 32)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 164](contracts/QuantAMMStorage.sol#L164)

	```solidity
	                        targetArray[targetIndex] = int256(int32(sourceElem)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 175](contracts/QuantAMMStorage.sol#L175)

	```solidity
	                    stickyEndSourceElem = _sourceArray.length - 1;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 178](contracts/QuantAMMStorage.sol#L178)

	```solidity
	        } else if (_targetArrayLength == 8) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 182](contracts/QuantAMMStorage.sol#L182)

	```solidity
	            targetArray[0] = (sourceElem >> 224) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 183](contracts/QuantAMMStorage.sol#L183)

	```solidity
	            targetArray[1] = int256(int32(sourceElem >> 192)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 184](contracts/QuantAMMStorage.sol#L184)

	```solidity
	            targetArray[2] = int256(int32(sourceElem >> 160)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 185](contracts/QuantAMMStorage.sol#L185)

	```solidity
	            targetArray[3] = int256(int32(sourceElem >> 128)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 186](contracts/QuantAMMStorage.sol#L186)

	```solidity
	            targetArray[4] = int256(int32(sourceElem >> 96)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 187](contracts/QuantAMMStorage.sol#L187)

	```solidity
	            targetArray[5] = int256(int32(sourceElem >> 64)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 188](contracts/QuantAMMStorage.sol#L188)

	```solidity
	            targetArray[6] = int256(int32(sourceElem >> 32)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 189](contracts/QuantAMMStorage.sol#L189)

	```solidity
	            targetArray[7] = int256(int32(sourceElem)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 195](contracts/QuantAMMStorage.sol#L195)

	```solidity
	                uint offset = 224;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 197](contracts/QuantAMMStorage.sol#L197)

	```solidity
	                    targetArray[i] = int256(int32(_sourceArray[stickyEndSourceElem] >> offset)) * 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 198](contracts/QuantAMMStorage.sol#L198)

	```solidity
	                    offset -= 32;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 213](contracts/QuantAMMStorage.sol#L213)

	```solidity
	        if (_sourceArray.length >= 8) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 214](contracts/QuantAMMStorage.sol#L214)

	```solidity
	            for (uint i = _sourceArray.length; i >= 8; ) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 216](contracts/QuantAMMStorage.sol#L216)

	```solidity
	                    if (i % 8 == 0) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 227](contracts/QuantAMMStorage.sol#L227)

	```solidity
	                    targetArrayLength = (nonStickySourceLength / 8) + 1;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 231](contracts/QuantAMMStorage.sol#L231)

	```solidity
	                    targetArrayLength = (nonStickySourceLength) / 8;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 240](contracts/QuantAMMStorage.sol#L240)

	```solidity
	                        int256(_sourceArray[i] / 1e9),
	```

- Found in contracts/QuantAMMStorage.sol [Line: 241](contracts/QuantAMMStorage.sol#L241)

	```solidity
	                        int256(_sourceArray[i + 1] / 1e9),
	```

- Found in contracts/QuantAMMStorage.sol [Line: 242](contracts/QuantAMMStorage.sol#L242)

	```solidity
	                        int256(_sourceArray[i + 2] / 1e9),
	```

- Found in contracts/QuantAMMStorage.sol [Line: 243](contracts/QuantAMMStorage.sol#L243)

	```solidity
	                        int256(_sourceArray[i + 3] / 1e9),
	```

- Found in contracts/QuantAMMStorage.sol [Line: 244](contracts/QuantAMMStorage.sol#L244)

	```solidity
	                        int256(_sourceArray[i + 4] / 1e9),
	```

- Found in contracts/QuantAMMStorage.sol [Line: 245](contracts/QuantAMMStorage.sol#L245)

	```solidity
	                        int256(_sourceArray[i + 5] / 1e9),
	```

- Found in contracts/QuantAMMStorage.sol [Line: 246](contracts/QuantAMMStorage.sol#L246)

	```solidity
	                        int256(_sourceArray[i + 6] / 1e9),
	```

- Found in contracts/QuantAMMStorage.sol [Line: 247](contracts/QuantAMMStorage.sol#L247)

	```solidity
	                        int256(_sourceArray[i + 7] / 1e9)
	```

- Found in contracts/QuantAMMStorage.sol [Line: 250](contracts/QuantAMMStorage.sol#L250)

	```solidity
	                    i += 8;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 258](contracts/QuantAMMStorage.sol#L258)

	```solidity
	                if (_sourceArray.length <= 8) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 259](contracts/QuantAMMStorage.sol#L259)

	```solidity
	                    targetArrayLength = 1;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 261](contracts/QuantAMMStorage.sol#L261)

	```solidity
	                    targetArrayLength = (nonStickySourceLength / 8) + 1;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 270](contracts/QuantAMMStorage.sol#L270)

	```solidity
	            uint offset = 224;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 274](contracts/QuantAMMStorage.sol#L274)

	```solidity
	                    int256 elem = _sourceArray[i] / 1e9;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 276](contracts/QuantAMMStorage.sol#L276)

	```solidity
	                    packed |= int256(uint256(elem << 224) >> 224) << offset;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 277](contracts/QuantAMMStorage.sol#L277)

	```solidity
	                    offset -= 32;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 298](contracts/QuantAMMStorage.sol#L298)

	```solidity
	        if (_sourceArray.length % 2 == 0) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 300](contracts/QuantAMMStorage.sol#L300)

	```solidity
	                targetArrayLength = (targetArrayLength) / 2;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 303](contracts/QuantAMMStorage.sol#L303)

	```solidity
	            for (uint i; i < sourceArrayLength - 1; ) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 304](contracts/QuantAMMStorage.sol#L304)

	```solidity
	                targetArray[storageIndex] = _quantAMMPackTwo128(_sourceArray[i], _sourceArray[i + 1]);
	```

- Found in contracts/QuantAMMStorage.sol [Line: 306](contracts/QuantAMMStorage.sol#L306)

	```solidity
	                    i += 2;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 311](contracts/QuantAMMStorage.sol#L311)

	```solidity
	            int256 lastArrayItem = _sourceArray[_sourceArray.length - 1];
	```

- Found in contracts/QuantAMMStorage.sol [Line: 317](contracts/QuantAMMStorage.sol#L317)

	```solidity
	                targetArrayLength = ((targetArrayLength - 1) / 2) + 1;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 320](contracts/QuantAMMStorage.sol#L320)

	```solidity
	            uint sourceArrayLengthMinusTwo = sourceArrayLength - 2;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 322](contracts/QuantAMMStorage.sol#L322)

	```solidity
	                targetArray[storageIndex] = _quantAMMPackTwo128(_sourceArray[i], _sourceArray[i + 1]);
	```

- Found in contracts/QuantAMMStorage.sol [Line: 324](contracts/QuantAMMStorage.sol#L324)

	```solidity
	                    i += 2;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 328](contracts/QuantAMMStorage.sol#L328)

	```solidity
	            targetArray[storageIndex] = int256(int128(_sourceArray[sourceArrayLength - 1]));
	```

- Found in contracts/QuantAMMStorage.sol [Line: 339](contracts/QuantAMMStorage.sol#L339)

	```solidity
	        require(_sourceArray.length * 2 >= _targetArrayLength, "SRC!=TGT");
	```

- Found in contracts/QuantAMMStorage.sol [Line: 342](contracts/QuantAMMStorage.sol#L342)

	```solidity
	        uint sourceArrayLengthMinusOne = _sourceArray.length - 1;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 343](contracts/QuantAMMStorage.sol#L343)

	```solidity
	        bool divisibleByTwo = _targetArrayLength % 2 == 0;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 345](contracts/QuantAMMStorage.sol#L345)

	```solidity
	            targetArray[targetIndex] = _sourceArray[i] >> 128;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 359](contracts/QuantAMMStorage.sol#L359)

	```solidity
	            targetArray[_targetArrayLength - 1] = int256(int128(_sourceArray[sourceArrayLengthMinusOne]));
	```

- Found in contracts/QuantAMMStorage.sol [Line: 387](contracts/QuantAMMStorage.sol#L387)

	```solidity
	        require(targetArrayLength * 2 >= _sourceMatrix.length * _sourceMatrix.length, "Matrix doesnt fit storage");
	```

- Found in contracts/QuantAMMStorage.sol [Line: 399](contracts/QuantAMMStorage.sol#L399)

	```solidity
	                    if (right == 1) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 403](contracts/QuantAMMStorage.sol#L403)

	```solidity
	                            (leftInt << 128) |
	```

- Found in contracts/QuantAMMStorage.sol [Line: 404](contracts/QuantAMMStorage.sol#L404)

	```solidity
	                            int256(uint256(_sourceMatrix[i][j] << 128) >> 128);
	```

- Found in contracts/QuantAMMStorage.sol [Line: 408](contracts/QuantAMMStorage.sol#L408)

	```solidity
	                        right = 1;
	```

- Found in contracts/QuantAMMStorage.sol [Line: 414](contracts/QuantAMMStorage.sol#L414)

	```solidity
	            if (((_sourceMatrix.length * _sourceMatrix.length) % 2) != 0) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 415](contracts/QuantAMMStorage.sol#L415)

	```solidity
	                _targetArray[targetArrayLength - 1] = int256(
	```

- Found in contracts/QuantAMMStorage.sol [Line: 416](contracts/QuantAMMStorage.sol#L416)

	```solidity
	                    int128(_sourceMatrix[_sourceMatrix.length - 1][_sourceMatrix.length - 1])
	```

- Found in contracts/QuantAMMStorage.sol [Line: 436](contracts/QuantAMMStorage.sol#L436)

	```solidity
	        require(_sourceArray.length * 2 >= _numberOfAssets * _numberOfAssets, "Source cannot provide target");
	```

- Found in contracts/QuantAMMStorage.sol [Line: 449](contracts/QuantAMMStorage.sol#L449)

	```solidity
	                targetArray[targetRow][targetIndex] = int256(int128(_sourceArray[i] >> 128));
	```

- Found in contracts/QuantAMMStorage.sol [Line: 481](contracts/QuantAMMStorage.sol#L481)

	```solidity
	                    targetArray[targetRow][targetIndex] = int256(int128(_sourceArray[i] >> 128));
	```

- Found in contracts/QuantAMMStorage.sol [Line: 508](contracts/QuantAMMStorage.sol#L508)

	```solidity
	        if ((_numberOfAssets * _numberOfAssets) % 2 != 0) {
	```

- Found in contracts/QuantAMMStorage.sol [Line: 509](contracts/QuantAMMStorage.sol#L509)

	```solidity
	            targetArray[_numberOfAssets - 1][_numberOfAssets - 1] = int256(
	```

- Found in contracts/QuantAMMStorage.sol [Line: 510](contracts/QuantAMMStorage.sol#L510)

	```solidity
	                int128(_sourceArray[_sourceArray.length - 1])
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 184](contracts/QuantAMMWeightedPool.sol#L184)

	```solidity
	        require(params.poolDetails.length <= 50, "Limit exceeds array length");
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 186](contracts/QuantAMMWeightedPool.sol#L186)

	```solidity
	            require(params.poolDetails[i].length == 4, "detail needs all 4 [category, name, type, detail]");
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 225](contracts/QuantAMMWeightedPool.sol#L225)

	```solidity
	                && keccak256(abi.encodePacked(detail[1])) == keccak256(abi.encodePacked(name))){
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 226](contracts/QuantAMMWeightedPool.sol#L226)

	```solidity
	                return (detail[2], detail[3]);
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 265](contracts/QuantAMMWeightedPool.sol#L265)

	```solidity
	        if ((request.indexIn < 4 && request.indexOut < 4) || (request.indexIn >= 4 && request.indexOut >= 4)) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 333](contracts/QuantAMMWeightedPool.sol#L333)

	```solidity
	        if (tokenIndexTwo >= 4) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 334](contracts/QuantAMMWeightedPool.sol#L334)

	```solidity
	            firstTokenIndex = tokenIndexOne - 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 335](contracts/QuantAMMWeightedPool.sol#L335)

	```solidity
	            secondTokenIndex = tokenIndexTwo - 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 336](contracts/QuantAMMWeightedPool.sol#L336)

	```solidity
	            totalTokensInPacked -= 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 339](contracts/QuantAMMWeightedPool.sol#L339)

	```solidity
	            if (totalTokens > 4) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 340](contracts/QuantAMMWeightedPool.sol#L340)

	```solidity
	                totalTokensInPacked = 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 396](contracts/QuantAMMWeightedPool.sol#L396)

	```solidity
	        if (tokenIndex >= 4) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 398](contracts/QuantAMMWeightedPool.sol#L398)

	```solidity
	            index = tokenIndex - 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 400](contracts/QuantAMMWeightedPool.sol#L400)

	```solidity
	            tokenIndexInPacked -= 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 402](contracts/QuantAMMWeightedPool.sol#L402)

	```solidity
	            if (totalTokens > 4) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 403](contracts/QuantAMMWeightedPool.sol#L403)

	```solidity
	                tokenIndexInPacked = 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 439](contracts/QuantAMMWeightedPool.sol#L439)

	```solidity
	            if (totalTokens > 4) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 440](contracts/QuantAMMWeightedPool.sol#L440)

	```solidity
	                tokenIndex = 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 449](contracts/QuantAMMWeightedPool.sol#L449)

	```solidity
	            normalizedWeights[1] = calculateBlockNormalisedWeight(
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 450](contracts/QuantAMMWeightedPool.sol#L450)

	```solidity
	                firstFourWeights[1],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 451](contracts/QuantAMMWeightedPool.sol#L451)

	```solidity
	                firstFourWeights[tokenIndex + 1],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 455](contracts/QuantAMMWeightedPool.sol#L455)

	```solidity
	            if (totalTokens > 2) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 456](contracts/QuantAMMWeightedPool.sol#L456)

	```solidity
	                normalizedWeights[2] = calculateBlockNormalisedWeight(
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 457](contracts/QuantAMMWeightedPool.sol#L457)

	```solidity
	                    firstFourWeights[2],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 458](contracts/QuantAMMWeightedPool.sol#L458)

	```solidity
	                    firstFourWeights[tokenIndex + 2],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 464](contracts/QuantAMMWeightedPool.sol#L464)

	```solidity
	            if (totalTokens > 3) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 465](contracts/QuantAMMWeightedPool.sol#L465)

	```solidity
	                normalizedWeights[3] = calculateBlockNormalisedWeight(
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 466](contracts/QuantAMMWeightedPool.sol#L466)

	```solidity
	                    firstFourWeights[3],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 467](contracts/QuantAMMWeightedPool.sol#L467)

	```solidity
	                    firstFourWeights[tokenIndex + 3],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 475](contracts/QuantAMMWeightedPool.sol#L475)

	```solidity
	            if (totalTokens == 4) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 480](contracts/QuantAMMWeightedPool.sol#L480)

	```solidity
	            uint256 moreThan4Tokens = totalTokens - 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 482](contracts/QuantAMMWeightedPool.sol#L482)

	```solidity
	            if (totalTokens > 4) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 483](contracts/QuantAMMWeightedPool.sol#L483)

	```solidity
	                normalizedWeights[4] = calculateBlockNormalisedWeight(
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 491](contracts/QuantAMMWeightedPool.sol#L491)

	```solidity
	            if (totalTokens > 5) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 492](contracts/QuantAMMWeightedPool.sol#L492)

	```solidity
	                normalizedWeights[5] = calculateBlockNormalisedWeight(
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 493](contracts/QuantAMMWeightedPool.sol#L493)

	```solidity
	                    secondFourWeights[1],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 494](contracts/QuantAMMWeightedPool.sol#L494)

	```solidity
	                    secondFourWeights[moreThan4Tokens + 1],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 500](contracts/QuantAMMWeightedPool.sol#L500)

	```solidity
	            if (totalTokens > 6) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 501](contracts/QuantAMMWeightedPool.sol#L501)

	```solidity
	                normalizedWeights[6] = calculateBlockNormalisedWeight(
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 502](contracts/QuantAMMWeightedPool.sol#L502)

	```solidity
	                    secondFourWeights[2],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 503](contracts/QuantAMMWeightedPool.sol#L503)

	```solidity
	                    secondFourWeights[moreThan4Tokens + 2],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 509](contracts/QuantAMMWeightedPool.sol#L509)

	```solidity
	            if (totalTokens > 7) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 510](contracts/QuantAMMWeightedPool.sol#L510)

	```solidity
	                normalizedWeights[7] = calculateBlockNormalisedWeight(
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 511](contracts/QuantAMMWeightedPool.sol#L511)

	```solidity
	                    secondFourWeights[3],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 512](contracts/QuantAMMWeightedPool.sol#L512)

	```solidity
	                    secondFourWeights[moreThan4Tokens + 3],
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 533](contracts/QuantAMMWeightedPool.sol#L533)

	```solidity
	        int256 multiplierScaled18 = multiplier * 1e18;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 579](contracts/QuantAMMWeightedPool.sol#L579)

	```solidity
	        uint firstTokenOffset = tokenCount < 4 ? tokenCount : 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 580](contracts/QuantAMMWeightedPool.sol#L580)

	```solidity
	        uint256 moreThan4Tokens = tokenCount  < 4 ? 0 : tokenCount - 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 582](contracts/QuantAMMWeightedPool.sol#L582)

	```solidity
	            if (i < 4) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 586](contracts/QuantAMMWeightedPool.sol#L586)

	```solidity
	                data.weightsAtLastUpdateInterval[i] = secondFourWeights[i - 4];
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 587](contracts/QuantAMMWeightedPool.sol#L587)

	```solidity
	                data.weightBlockMultipliers[i] = secondFourWeights[i - 4 + moreThan4Tokens];
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 623](contracts/QuantAMMWeightedPool.sol#L623)

	```solidity
	        require(_weights.length == _totalTokens * 2, "WLDL"); //weight length different
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 625](contracts/QuantAMMWeightedPool.sol#L625)

	```solidity
	        if (_weights.length > 8) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 628](contracts/QuantAMMWeightedPool.sol#L628)

	```solidity
	            _normalizedSecondFourWeights = quantAMMPack32Array(splitWeights[1])[0];
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 651](contracts/QuantAMMWeightedPool.sol#L651)

	```solidity
	        int256[] memory _weightsAndBlockMultiplier = new int256[](_weights.length * 2);
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 671](contracts/QuantAMMWeightedPool.sol#L671)

	```solidity
	        if (_weightsAndBlockMultiplier.length > 8) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 674](contracts/QuantAMMWeightedPool.sol#L674)

	```solidity
	            _normalizedSecondFourWeights = quantAMMPack32Array(splitWeights[1])[0];
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 725](contracts/QuantAMMWeightedPool.sol#L725)

	```solidity
	        uint256 tokenLength = weights.length / 2;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 726](contracts/QuantAMMWeightedPool.sol#L726)

	```solidity
	        splitWeights = new int256[][](2);
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 727](contracts/QuantAMMWeightedPool.sol#L727)

	```solidity
	        splitWeights[0] = new int256[](8);
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 728](contracts/QuantAMMWeightedPool.sol#L728)

	```solidity
	        for (uint i; i < 4; ) {
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 730](contracts/QuantAMMWeightedPool.sol#L730)

	```solidity
	            splitWeights[0][i + 4] = weights[i + tokenLength];
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 737](contracts/QuantAMMWeightedPool.sol#L737)

	```solidity
	        splitWeights[1] = new int256[](8);
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 739](contracts/QuantAMMWeightedPool.sol#L739)

	```solidity
	        uint256 moreThan4Tokens = tokenLength - 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 741](contracts/QuantAMMWeightedPool.sol#L741)

	```solidity
	            uint256 i4 = i + 4;
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 742](contracts/QuantAMMWeightedPool.sol#L742)

	```solidity
	            splitWeights[1][i] = weights[i4];
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 743](contracts/QuantAMMWeightedPool.sol#L743)

	```solidity
	            splitWeights[1][i + moreThan4Tokens] = weights[i4 + tokenLength];
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 766](contracts/QuantAMMWeightedPool.sol#L766)

	```solidity
	            require(currentLambda > PRBMathSD59x18.fromInt(0) && currentLambda < PRBMathSD59x18.fromInt(1), "INVLAM"); //Invalid lambda value
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 770](contracts/QuantAMMWeightedPool.sol#L770)

	```solidity
	            _poolSettings.lambda.length == 1 || _poolSettings.lambda.length == _initialWeights.length,
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 775](contracts/QuantAMMWeightedPool.sol#L775)

	```solidity
	            currentEpsilonMax > PRBMathSD59x18.fromInt(0) && currentEpsilonMax <= PRBMathSD59x18.fromInt(1),
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 783](contracts/QuantAMMWeightedPool.sol#L783)

	```solidity
	                PRBMathSD59x18.fromInt(1) / int256(uint256((_initialWeights.length))) &&
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 784](contracts/QuantAMMWeightedPool.sol#L784)

	```solidity
	                int256(uint256(_poolSettings.absoluteWeightGuardRail)) >= 0.01e18,
	```

- Found in contracts/QuantAMMWeightedPool.sol [Line: 792](contracts/QuantAMMWeightedPool.sol#L792)

	```solidity
	        require(_poolSettings.maxTradeSizeRatio > 0 && _poolSettings.maxTradeSizeRatio <= 0.3e18, "INVMAXTRADE"); //Invalid max trade size
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 128](contracts/UpdateWeightRunner.sol#L128)

	```solidity
	        require(_quantAMMSwapFeeTake <= 1e18, "Swap fee must be less than 100%");
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 143](contracts/UpdateWeightRunner.sol#L143)

	```solidity
	        require(_quantAMMUpliftFeeTake <= 1e18, "Uplift fee must be less than 100%");
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 367](contracts/UpdateWeightRunner.sol#L367)

	```solidity
	                for (uint j = 1 /*0 already done via optimised poolOracles*/; j < numAssetOracles; ) {
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 375](contracts/UpdateWeightRunner.sol#L375)

	```solidity
	                    } else if (j == numAssetOracles - 1) {
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 462](contracts/UpdateWeightRunner.sol#L462)

	```solidity
	        uint weightAndMultiplierLength = local.currentWeights.length * 2;
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 476](contracts/UpdateWeightRunner.sol#L476)

	```solidity
	            int256 upperGuardRail = (PRBMathSD59x18.fromInt(1) -
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 479](contracts/UpdateWeightRunner.sol#L479)

	```solidity
	                        PRBMathSD59x18.fromInt(int256(local.currentWeights.length - 1)),
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 507](contracts/UpdateWeightRunner.sol#L507)

	```solidity
	                    blockTimeUntilGuardRailHit = weightBetweenTargetAndMax / int256(uint256(-1 * blockMultiplier));
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 581](contracts/UpdateWeightRunner.sol#L581)

	```solidity
	                require(_weights[i] < 1e18, "greater than 1 weight not allowed");
	```

- Found in contracts/mock/MockPool.sol [Line: 31](contracts/mock/MockPool.sol#L31)

	```solidity
	        epsilonMax = 1 * 1e18; // PRBMathSD69x18 1
	```

- Found in contracts/mock/MockPool.sol [Line: 32](contracts/mock/MockPool.sol#L32)

	```solidity
	        absoluteWeightGuardRail = 1 * 1e18; // PRBMathSD69x18 1
	```

- Found in contracts/mock/MockPool.sol [Line: 33](contracts/mock/MockPool.sol#L33)

	```solidity
	        oracleStalenessThreshold = 4 hours;
	```

- Found in contracts/mock/MockQuantAMMBasePool.sol [Line: 39](contracts/mock/MockQuantAMMBasePool.sol#L39)

	```solidity
	        epsilonMax = 1 * 1e18; // PRBMathSD69x18 1
	```

- Found in contracts/mock/MockQuantAMMBasePool.sol [Line: 40](contracts/mock/MockQuantAMMBasePool.sol#L40)

	```solidity
	        absoluteWeightGuardRail = 1 * 1e18; // PRBMathSD69x18 1
	```

- Found in contracts/mock/MockQuantAMMBasePool.sol [Line: 41](contracts/mock/MockQuantAMMBasePool.sol#L41)

	```solidity
	        oracleStalenessThreshold = 10;
	```

- Found in contracts/mock/MockQuantAMMBasePool.sol [Line: 109](contracts/mock/MockQuantAMMBasePool.sol#L109)

	```solidity
	        uint256[] memory normalizedWeights = new uint256[](weights.length / 2);
	```

- Found in contracts/mock/MockQuantAMMBasePool.sol [Line: 110](contracts/mock/MockQuantAMMBasePool.sol#L110)

	```solidity
	        for (uint256 i = 0; i < weights.length / 2; i++) {
	```

- Found in contracts/mock/MockQuantAMMStorage.sol [Line: 46](contracts/mock/MockQuantAMMStorage.sol#L46)

	```solidity
	        if ((sourceMatrix.length * sourceMatrix.length) % 2 == 0) {
	```

- Found in contracts/mock/MockQuantAMMStorage.sol [Line: 47](contracts/mock/MockQuantAMMStorage.sol#L47)

	```solidity
	            storageLength = (sourceMatrix.length * sourceMatrix.length) / 2;
	```

- Found in contracts/mock/MockQuantAMMStorage.sol [Line: 49](contracts/mock/MockQuantAMMStorage.sol#L49)

	```solidity
	            storageLength = ((sourceMatrix.length * sourceMatrix.length) - 1) / 2;
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 16](contracts/rules/AntimomentumUpdateRule.sol#L16)

	```solidity
	        parameterDescriptions = new string[](3);
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 18](contracts/rules/AntimomentumUpdateRule.sol#L18)

	```solidity
	        parameterDescriptions[1] = "Use raw price: 0 = use moving average, 1 = use raw price to be used as the denominator";
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 19](contracts/rules/AntimomentumUpdateRule.sol#L19)

	```solidity
	        parameterDescriptions[2] = "Lambda: Lambda dictates the estimator weighting and price smoothing for a given period of time";
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 65](contracts/rules/AntimomentumUpdateRule.sol#L65)

	```solidity
	        if (_parameters.length > 1) {
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 66](contracts/rules/AntimomentumUpdateRule.sol#L66)

	```solidity
	            locals.useRawPrice = _parameters[1][0] == ONE;
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 82](contracts/rules/AntimomentumUpdateRule.sol#L82)

	```solidity
	            if (locals.kappa.length == 1) {
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 94](contracts/rules/AntimomentumUpdateRule.sol#L94)

	```solidity
	        if (locals.kappa.length == 1) {
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 149](contracts/rules/AntimomentumUpdateRule.sol#L149)

	```solidity
	        if (_parameters.length == 1 || (_parameters.length == 2 && _parameters[1].length == 1)) {
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 151](contracts/rules/AntimomentumUpdateRule.sol#L151)

	```solidity
	            uint16 valid = uint16(kappa.length) > 0 ? 1 : 0;
	```

- Found in contracts/rules/AntimomentumUpdateRule.sol [Line: 161](contracts/rules/AntimomentumUpdateRule.sol#L161)

	```solidity
	            return valid == 1;
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 16](contracts/rules/ChannelFollowingUpdateRule.sol#L16)

	```solidity
	        parameterDescriptions = new string[](7);
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 18](contracts/rules/ChannelFollowingUpdateRule.sol#L18)

	```solidity
	        parameterDescriptions[1] = "Width: Width parameter for the mean reversion channel.";
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 19](contracts/rules/ChannelFollowingUpdateRule.sol#L19)

	```solidity
	        parameterDescriptions[2] = "Amplitude: Amplitude of the mean reversion effect.";
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 20](contracts/rules/ChannelFollowingUpdateRule.sol#L20)

	```solidity
	        parameterDescriptions[3] = "Exponents: Exponents for the trend following portion.";
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 21](contracts/rules/ChannelFollowingUpdateRule.sol#L21)

	```solidity
	        parameterDescriptions[4] = "Inverse Scaling: Scaling factor for channel portion. "
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 24](contracts/rules/ChannelFollowingUpdateRule.sol#L24)

	```solidity
	        parameterDescriptions[5] = "Pre-exp Scaling: Scaling factor before exponentiation in the trend following portion.";
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 25](contracts/rules/ChannelFollowingUpdateRule.sol#L25)

	```solidity
	        parameterDescriptions[6] = "Use raw price: 0 = use moving average, 1 = use raw price for denominator of price gradient.";
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 111](contracts/rules/ChannelFollowingUpdateRule.sol#L111)

	```solidity
	        locals.width = _parameters[1];
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 112](contracts/rules/ChannelFollowingUpdateRule.sol#L112)

	```solidity
	        locals.amplitude = _parameters[2];
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 113](contracts/rules/ChannelFollowingUpdateRule.sol#L113)

	```solidity
	        locals.exponents = _parameters[3];
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 114](contracts/rules/ChannelFollowingUpdateRule.sol#L114)

	```solidity
	        locals.inverseScaling = _parameters[4];
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 115](contracts/rules/ChannelFollowingUpdateRule.sol#L115)

	```solidity
	        locals.preExpScaling = _parameters[5];
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 122](contracts/rules/ChannelFollowingUpdateRule.sol#L122)

	```solidity
	        locals.useRawPrice = _parameters[6][0] == ONE;
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 150](contracts/rules/ChannelFollowingUpdateRule.sol#L150)

	```solidity
	            if (locals.kappa.length == 1) {
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 212](contracts/rules/ChannelFollowingUpdateRule.sol#L212)

	```solidity
	            if (locals.kappa.length == 1) {
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 226](contracts/rules/ChannelFollowingUpdateRule.sol#L226)

	```solidity
	        if (locals.kappa.length == 1) {
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 280](contracts/rules/ChannelFollowingUpdateRule.sol#L280)

	```solidity
	        if (_parameters.length != 7) return false;
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 285](contracts/rules/ChannelFollowingUpdateRule.sol#L285)

	```solidity
	        for (uint i = 1; i < 6; i++) {
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 294](contracts/rules/ChannelFollowingUpdateRule.sol#L294)

	```solidity
	            if (_parameters[1][i] <= 0) return false; // width must be positive
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 295](contracts/rules/ChannelFollowingUpdateRule.sol#L295)

	```solidity
	            if (_parameters[2][i] <= 0) return false; // amplitude must be positive
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 296](contracts/rules/ChannelFollowingUpdateRule.sol#L296)

	```solidity
	            if (_parameters[3][i] <= 0) return false; // exponents must be positive
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 297](contracts/rules/ChannelFollowingUpdateRule.sol#L297)

	```solidity
	            if (_parameters[4][i] <= 0) return false; // inverse scaling must be positive
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 298](contracts/rules/ChannelFollowingUpdateRule.sol#L298)

	```solidity
	            if (_parameters[5][i] <= 0) return false; // pre-exp scaling must be positive
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 301](contracts/rules/ChannelFollowingUpdateRule.sol#L301)

	```solidity
	        if (_parameters[6].length != 1) return false;
	```

- Found in contracts/rules/ChannelFollowingUpdateRule.sol [Line: 302](contracts/rules/ChannelFollowingUpdateRule.sol#L302)

	```solidity
	        if (_parameters[6][0] != 0 && _parameters[6][0] != PRBMathSD59x18.fromInt(1)) return false;
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 14](contracts/rules/DifferenceMomentumUpdateRule.sol#L14)

	```solidity
	        parameterDescriptions = new string[](3);
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 19](contracts/rules/DifferenceMomentumUpdateRule.sol#L19)

	```solidity
	            1
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 22](contracts/rules/DifferenceMomentumUpdateRule.sol#L22)

	```solidity
	            2
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 69](contracts/rules/DifferenceMomentumUpdateRule.sol#L69)

	```solidity
	        int128[] memory lambdaShort = new int128[](_parameters[1].length);
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 71](contracts/rules/DifferenceMomentumUpdateRule.sol#L71)

	```solidity
	            lambdaShort[locals.i] = int128(_parameters[1][locals.i]);
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 106](contracts/rules/DifferenceMomentumUpdateRule.sol#L106)

	```solidity
	            if (locals.kappaStore.length == 1) {
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 118](contracts/rules/DifferenceMomentumUpdateRule.sol#L118)

	```solidity
	        if (locals.kappaStore.length == 1) {
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 189](contracts/rules/DifferenceMomentumUpdateRule.sol#L189)

	```solidity
	        if (_parameters.length != 2) {
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 194](contracts/rules/DifferenceMomentumUpdateRule.sol#L194)

	```solidity
	        int256[] memory shortLambda = _parameters[1];
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 202](contracts/rules/DifferenceMomentumUpdateRule.sol#L202)

	```solidity
	            if (shortLambda[i] > int256(1e18)) {
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 210](contracts/rules/DifferenceMomentumUpdateRule.sol#L210)

	```solidity
	        uint16 valid = uint16(kappa.length) > 0 ? 1 : 0;
	```

- Found in contracts/rules/DifferenceMomentumUpdateRule.sol [Line: 222](contracts/rules/DifferenceMomentumUpdateRule.sol#L222)

	```solidity
	        return valid == 1;
	```

- Found in contracts/rules/MinimumVarianceUpdateRule.sol [Line: 14](contracts/rules/MinimumVarianceUpdateRule.sol#L14)

	```solidity
	        parameterDescriptions = new string[](1);
	```

- Found in contracts/rules/MinimumVarianceUpdateRule.sol [Line: 43](contracts/rules/MinimumVarianceUpdateRule.sol#L43)

	```solidity
	        if (_parameters[0].length == 1) {
	```

- Found in contracts/rules/MinimumVarianceUpdateRule.sol [Line: 115](contracts/rules/MinimumVarianceUpdateRule.sol#L115)

	```solidity
	        if (_parameters.length == 1 && _parameters[0].length >= 1) {
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 14](contracts/rules/MomentumUpdateRule.sol#L14)

	```solidity
	        parameterDescriptions = new string[](3);
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 16](contracts/rules/MomentumUpdateRule.sol#L16)

	```solidity
	        parameterDescriptions[1] = "Use raw price: 0 = use moving average, 1 = use raw price";
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 17](contracts/rules/MomentumUpdateRule.sol#L17)

	```solidity
	        parameterDescriptions[2] = "Lambda: Lambda dictates the estimator weighting and price smoothing for a given period of time";
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 64](contracts/rules/MomentumUpdateRule.sol#L64)

	```solidity
	        if (_parameters.length > 1) {
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 65](contracts/rules/MomentumUpdateRule.sol#L65)

	```solidity
	            locals.useRawPrice = _parameters[1][0] == ONE;
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 84](contracts/rules/MomentumUpdateRule.sol#L84)

	```solidity
	            if (locals.kappaStore.length == 1) {
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 97](contracts/rules/MomentumUpdateRule.sol#L97)

	```solidity
	        if (locals.kappaStore.length == 1) {
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 159](contracts/rules/MomentumUpdateRule.sol#L159)

	```solidity
	        if (_parameters.length == 1 || (_parameters.length == 2 && _parameters[1].length == 1)) {
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 161](contracts/rules/MomentumUpdateRule.sol#L161)

	```solidity
	            uint16 valid = uint16(kappa.length) > 0 ? 1 : 0;
	```

- Found in contracts/rules/MomentumUpdateRule.sol [Line: 173](contracts/rules/MomentumUpdateRule.sol#L173)

	```solidity
	            return valid == 1;
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 14](contracts/rules/PowerChannelUpdateRule.sol#L14)

	```solidity
	        parameterDescriptions = new string[](4);
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 16](contracts/rules/PowerChannelUpdateRule.sol#L16)

	```solidity
	        parameterDescriptions[1] = "Q: Q dictates the harshness of the channel boundry";
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 17](contracts/rules/PowerChannelUpdateRule.sol#L17)

	```solidity
	        parameterDescriptions[2] = "Use raw price: 0 = use moving average, 1 = use raw price to be used as the denominator";
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 18](contracts/rules/PowerChannelUpdateRule.sol#L18)

	```solidity
	        parameterDescriptions[3] = "Lambda: Lambda dictates the estimator weighting and price smoothing for a given period of time";
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 79](contracts/rules/PowerChannelUpdateRule.sol#L79)

	```solidity
	        if (_parameters.length > 2) {
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 80](contracts/rules/PowerChannelUpdateRule.sol#L80)

	```solidity
	            locals.useRawPrice = _parameters[2][0] == ONE;
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 83](contracts/rules/PowerChannelUpdateRule.sol#L83)

	```solidity
	        bool scalarQ = _parameters[1].length == 1;
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 84](contracts/rules/PowerChannelUpdateRule.sol#L84)

	```solidity
	        locals.q = _parameters[1][0];
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 89](contracts/rules/PowerChannelUpdateRule.sol#L89)

	```solidity
	                locals.q = _parameters[1][locals.i];
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 105](contracts/rules/PowerChannelUpdateRule.sol#L105)

	```solidity
	            if (locals.kappa.length == 1) {
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 119](contracts/rules/PowerChannelUpdateRule.sol#L119)

	```solidity
	        if (locals.kappa.length == 1) {
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 180](contracts/rules/PowerChannelUpdateRule.sol#L180)

	```solidity
	            (parameters.length == 2 || (parameters.length == 3 && parameters[2].length == 1)) &&
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 182](contracts/rules/PowerChannelUpdateRule.sol#L182)

	```solidity
	            (parameters[0].length == 1 && parameters[1].length == 1 
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 183](contracts/rules/PowerChannelUpdateRule.sol#L183)

	```solidity
	            || parameters[1].length == parameters[0].length)
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 196](contracts/rules/PowerChannelUpdateRule.sol#L196)

	```solidity
	            for (uint i; i < parameters[1].length; ) {
	```

- Found in contracts/rules/PowerChannelUpdateRule.sol [Line: 197](contracts/rules/PowerChannelUpdateRule.sol#L197)

	```solidity
	                if(parameters[1][i] <= ONE){
	```

- Found in contracts/rules/UpdateRule.sol [Line: 93](contracts/rules/UpdateRule.sol#L93)

	```solidity
	        locals.nMinusOne = locals.numberOfAssets - 1;
	```

- Found in contracts/rules/UpdateRule.sol [Line: 108](contracts/rules/UpdateRule.sol#L108)

	```solidity
	                locals.intermediateMovingAverageStateLength *= 2;
	```

- Found in contracts/rules/UpdateRule.sol [Line: 126](contracts/rules/UpdateRule.sol#L126)

	```solidity
	        if (locals.numberOfAssets % 2 != 0) {
	```

- Found in contracts/rules/UpdateRule.sol [Line: 146](contracts/rules/UpdateRule.sol#L146)

	```solidity
	                locals.secondIndex = locals.i + 1;
	```

- Found in contracts/rules/UpdateRule.sol [Line: 164](contracts/rules/UpdateRule.sol#L164)

	```solidity
	                locals.i += 2;
	```

- Found in contracts/rules/UpdateRule.sol [Line: 168](contracts/rules/UpdateRule.sol#L168)

	```solidity
	        if (locals.numberOfAssets % 2 != 0) {
	```

- Found in contracts/rules/UpdateRule.sol [Line: 169](contracts/rules/UpdateRule.sol#L169)

	```solidity
	            locals.lastAssetIndex = locals.numberOfAssets - 1;
	```

- Found in contracts/rules/UpdateRule.sol [Line: 171](contracts/rules/UpdateRule.sol#L171)

	```solidity
	                locals.nMinusOne = ((locals.lastAssetIndex) / 2);
	```

- Found in contracts/rules/base/QuantammCovarianceBasedRule.sol [Line: 74](contracts/rules/base/QuantammCovarianceBasedRule.sol#L74)

	```solidity
	        if (_poolParameters.lambda.length == 1) {
	```

- Found in contracts/rules/base/QuantammCovarianceBasedRule.sol [Line: 146](contracts/rules/base/QuantammCovarianceBasedRule.sol#L146)

	```solidity
	                if ((_numberOfAssets * _numberOfAssets) % 2 == 0) {
	```

- Found in contracts/rules/base/QuantammCovarianceBasedRule.sol [Line: 147](contracts/rules/base/QuantammCovarianceBasedRule.sol#L147)

	```solidity
	                    intermediateCovarianceStates[_poolAddress] = new int256[]((_numberOfAssets * _numberOfAssets) / 2);
	```

- Found in contracts/rules/base/QuantammCovarianceBasedRule.sol [Line: 150](contracts/rules/base/QuantammCovarianceBasedRule.sol#L150)

	```solidity
	                        (((_numberOfAssets * _numberOfAssets) - 1) / 2) + 1
	```

- Found in contracts/rules/base/QuantammGradientBasedRule.sol [Line: 53](contracts/rules/base/QuantammGradientBasedRule.sol#L53)

	```solidity
	        bool notDivisibleByTwo = _poolParameters.numberOfAssets % 2 != 0;
	```

- Found in contracts/rules/base/QuantammGradientBasedRule.sol [Line: 54](contracts/rules/base/QuantammGradientBasedRule.sol#L54)

	```solidity
	        uint numberOfAssetsMinusOne = _poolParameters.numberOfAssets - 1;
	```

- Found in contracts/rules/base/QuantammGradientBasedRule.sol [Line: 59](contracts/rules/base/QuantammGradientBasedRule.sol#L59)

	```solidity
	        if (_poolParameters.lambda.length == 1) {
	```

- Found in contracts/rules/base/QuantammGradientBasedRule.sol [Line: 81](contracts/rules/base/QuantammGradientBasedRule.sol#L81)

	```solidity
	                    locals.secondIndex = i + 1;
	```

- Found in contracts/rules/base/QuantammGradientBasedRule.sol [Line: 98](contracts/rules/base/QuantammGradientBasedRule.sol#L98)

	```solidity
	                    i += 2;
	```

- Found in contracts/rules/base/QuantammGradientBasedRule.sol [Line: 142](contracts/rules/base/QuantammGradientBasedRule.sol#L142)

	```solidity
	                    locals.secondIndex = i + 1;
	```

- Found in contracts/rules/base/QuantammGradientBasedRule.sol [Line: 161](contracts/rules/base/QuantammGradientBasedRule.sol#L161)

	```solidity
	                    i += 2;
	```

- Found in contracts/rules/base/QuantammMathGuard.sol [Line: 42](contracts/rules/base/QuantammMathGuard.sol#L42)

	```solidity
	            if (weightLength == 1) {
	```

- Found in contracts/rules/base/QuantammMathGuard.sol [Line: 47](contracts/rules/base/QuantammMathGuard.sol#L47)

	```solidity
	                (PRBMathSD59x18.fromInt(int256(_weights.length - 1)).mul(_absoluteWeightGuardRail));
	```

- Found in contracts/rules/base/QuantammMathGuard.sol [Line: 121](contracts/rules/base/QuantammMathGuard.sol#L121)

	```solidity
	            return 1 * 1e18;
	```

- Found in contracts/rules/base/QuantammMathMovingAverage.sol [Line: 32](contracts/rules/base/QuantammMathMovingAverage.sol#L32)

	```solidity
	        if (_lambda.length == 1) {
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 62](contracts/rules/base/QuantammVarianceBasedRule.sol#L62)

	```solidity
	        locals.nMinusOne = locals.n - 1;
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 63](contracts/rules/base/QuantammVarianceBasedRule.sol#L63)

	```solidity
	        locals.notDivisibleByTwo = locals.n % 2 != 0;
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 69](contracts/rules/base/QuantammVarianceBasedRule.sol#L69)

	```solidity
	        if (_poolParameters.lambda.length == 1) {
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 91](contracts/rules/base/QuantammVarianceBasedRule.sol#L91)

	```solidity
	                    locals.secondIndex = i + 1;
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 109](contracts/rules/base/QuantammVarianceBasedRule.sol#L109)

	```solidity
	                    i += 2;
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 147](contracts/rules/base/QuantammVarianceBasedRule.sol#L147)

	```solidity
	                    locals.secondIndex = i + 1;
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 148](contracts/rules/base/QuantammVarianceBasedRule.sol#L148)

	```solidity
	                    locals.convertedLambda = int256(_poolParameters.lambda[i + 1]);
	```

- Found in contracts/rules/base/QuantammVarianceBasedRule.sol [Line: 167](contracts/rules/base/QuantammVarianceBasedRule.sol#L167)

	```solidity
	                    i += 2;
	```



## NC-4: Event is missing `indexed` fields

Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

- Found in contracts/QuantAMMWeightedPool.sol [Line: 122](contracts/QuantAMMWeightedPool.sol#L122)

	```solidity
	    event WeightsUpdated(address indexed poolAddress, int256[] weights);
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 54](contracts/UpdateWeightRunner.sol#L54)

	```solidity
	    event SetWeightManual(
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 60](contracts/UpdateWeightRunner.sol#L60)

	```solidity
	    event SetIntermediateValuesManually(
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 67](contracts/UpdateWeightRunner.sol#L67)

	```solidity
	    event SwapFeeTakeSet(uint256 oldSwapFee, uint256 newSwapFee);
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 68](contracts/UpdateWeightRunner.sol#L68)

	```solidity
	    event UpliftFeeTakeSet(uint256 oldSwapFee, uint256 newSwapFee);
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 71](contracts/UpdateWeightRunner.sol#L71)

	```solidity
	    event SetApprovedActionsForPool(address indexed caller, address indexed pool, uint256 actions);
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 72](contracts/UpdateWeightRunner.sol#L72)

	```solidity
	    event ETHUSDOracleSet(address ethUsdOracle);
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 73](contracts/UpdateWeightRunner.sol#L73)

	```solidity
	    event PoolRuleSet(
	```

- Found in contracts/UpdateWeightRunner.sol [Line: 83](contracts/UpdateWeightRunner.sol#L83)

	```solidity
	    event PoolLastRunSet(address poolAddress, uint40 time);
	```



